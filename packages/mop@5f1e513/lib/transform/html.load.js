montageDefine("5f1e513","lib/transform/html",{dependencies:["../rebase","../minify-javascript","jshint","../file","./css","../shim-minidom","minidom/dom","url2","html-minifier"],factory:function(t,e,i){function a(t,e,i){r(t,e);try{t.utf8=g(t.utf8,{removeComments:!0,collapseBooleanLiterals:!0,collapseWhitespace:!0,removeAttributeQuotes:!0,removeRedundantAttributes:!0,removeEmptyAttributes:!0})}catch(a){e.out.warn("Could not minify "+t.path),e.out.warn(a.message)}var n="montageDefine("+JSON.stringify(t["package"].hash)+","+JSON.stringify(t.relativeLocation)+","+JSON.stringify({text:t.utf8})+")",o=new d({fs:e.fs,utf8:n,location:t.location+".load.js",buildLocation:t.buildLocation+".load.js",relativeLocation:t.relativeLocation+".load.js","package":t["package"]});e.files[o.location]=o,t["package"].files[o.relativeLocation]=o,i&&i()}function r(t,e){var i,a,r,l=t["package"].getPackage({main:!0}),p=b.resolve(l.buildLocation,"manifest.appcache");s(t.document,function(s){if(s.nodeType===v.ELEMENT_NODE)switch(s.tagName){case"HTML":if(l.packageDescription.appcache){var f=b.relative(t.buildLocation,p);s.setAttribute("manifest",f)}break;case"STYLE":n(s,t,e);break;case"SCRIPT":c(s,"src",t,e),o(s,t,e);break;case"LINK":if(e.cssEmbedding&&"stylesheet"===s.getAttribute("rel")&&(r=s.getAttribute("href"),r.indexOf(":")===-1)){i=e.files[b.resolve(t.location,r)],void 0===i&&e.out.warn("Stylesheet file not found: "+b.resolve(t.location,r)),i=i?i.utf8:"",a=t.document.createElement("style"),c(s,"href",t,e);var u,m=b.resolve(s.getAttribute("href"),b.relative(l.buildLocation,t.buildLocation));u=h.resolve(m,i,e).trim(),u.length?(a.appendChild(t.document.createTextNode(u)),s.parentNode.replaceChild(a,s)):s.parentNode.removeChild(s)}break;default:c(s,"href",t,e),c(s,"src",t,e)}})}function n(t,e,i){var a=l(t),r=h.rebase(a,e,i);p(t,r,e.document)}function o(t,e,i){var a;if(a=t.hasAttribute("type")?t.getAttribute("type"):"application/javascript","application/javascript"===a||"text/javascript"===a){if(i.lint&&e["package"].isMainPackage()&&(t.hasAttribute("src")&&""!==l(t).trim()&&i.out.warn("A script tag must only have either a src or content in "+e.path),"text/javascript"===a?i.out.warn("Proper MIME type for JavaScript is application/javascript and should be omitted in "+e.path):t.hasAttribute("type")&&i.out.warn("Script MIME type should be omitted if application/javascript in "+e.path),m(l(t))||i.out.warn("JSHints for <script>: "+e.path)),t.hasAttribute("type")&&t.removeAttribute("type"),i.minify)try{p(t,u(l(t),e.path),e.document)}catch(r){i.out.warn("JavaScript parse error in "+e.path+": "+r.message)}}else if("text/m-objects"===a)i.out.warn("Deprecated text/m-objects block in "+e.path+". Use text/montage-serialization.");else if("text/montage-serialization"===a)try{i.minify&&p(t,JSON.stringify(JSON.parse(l(t))),e.document)}catch(n){if(!(n instanceof SyntaxError))throw n;i.out.warn("Syntax Error in Montage Serialization in "+e.path)}else"x-shader/x-fragment"===a||"x-shader/x-vertex"===a||i.out.warn("Unrecognized script type "+JSON.stringify(a)+" in "+e.path)}function s(t,e){var i;for(e(t),t=t.firstChild;t;)i=t.nextSibling,s(t,e),t=i}function c(t,e,i,a){if(t.hasAttribute(e)){var r=t.getAttribute(e),n=f(r,i,a);t.setAttribute(e,n)}}function l(t){return t.textContent}function p(t,e,i){for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(i.createTextNode(e))}var f=t("../rebase"),u=t("../minify-javascript"),m=t("jshint"),d=t("../file"),h=t("./css");t("../shim-minidom");var v=t("minidom/dom").Node,b=t("url2"),g=t("html-minifier").minify;i.exports=a}});