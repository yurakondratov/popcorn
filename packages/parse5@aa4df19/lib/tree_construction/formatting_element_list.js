"use strict";var NOAH_ARK_CAPACITY=3,FormattingElementList=module.exports=function(t){this.length=0,this.entries=[],this.treeAdapter=t,this.bookmark=null};FormattingElementList.MARKER_ENTRY="MARKER_ENTRY",FormattingElementList.ELEMENT_ENTRY="ELEMENT_ENTRY",FormattingElementList.prototype._getNoahArkConditionCandidates=function(t){var e=[];if(this.length>=NOAH_ARK_CAPACITY)for(var n=this.treeAdapter.getAttrList(t).length,r=this.treeAdapter.getTagName(t),i=this.treeAdapter.getNamespaceURI(t),s=this.length-1;s>=0;s--){var a=this.entries[s];if(a.type===FormattingElementList.MARKER_ENTRY)break;var o=a.element,h=this.treeAdapter.getAttrList(o);this.treeAdapter.getTagName(o)===r&&this.treeAdapter.getNamespaceURI(o)===i&&h.length===n&&e.push({idx:s,attrs:h})}return e.length<NOAH_ARK_CAPACITY?[]:e},FormattingElementList.prototype._ensureNoahArkCondition=function(t){var e=this._getNoahArkConditionCandidates(t),n=e.length;if(n){for(var r=this.treeAdapter.getAttrList(t),i=r.length,s={},a=0;a<i;a++){var o=r[a];s[o.name]=o.value}for(var a=0;a<i;a++)for(var h=0;h<n;h++){var l=e[h].attrs[a];if(s[l.name]!==l.value&&(e.splice(h,1),n--),e.length<NOAH_ARK_CAPACITY)return}for(var a=n-1;a>=NOAH_ARK_CAPACITY-1;a--)this.entries.splice(e[a].idx,1),this.length--}},FormattingElementList.prototype.insertMarker=function(){this.entries.push({type:FormattingElementList.MARKER_ENTRY}),this.length++},FormattingElementList.prototype.pushElement=function(t,e){this._ensureNoahArkCondition(t),this.entries.push({type:FormattingElementList.ELEMENT_ENTRY,element:t,token:e}),this.length++},FormattingElementList.prototype.insertElementAfterBookmark=function(t,e){for(var n=this.length-1;n>=0&&this.entries[n]!==this.bookmark;n--);this.entries.splice(n+1,0,{type:FormattingElementList.ELEMENT_ENTRY,element:t,token:e}),this.length++},FormattingElementList.prototype.removeEntry=function(t){for(var e=this.length-1;e>=0;e--)if(this.entries[e]===t){this.entries.splice(e,1),this.length--;break}},FormattingElementList.prototype.clearToLastMarker=function(){for(;this.length;){var t=this.entries.pop();if(this.length--,t.type===FormattingElementList.MARKER_ENTRY)break}},FormattingElementList.prototype.getElementEntryInScopeWithTagName=function(t){for(var e=this.length-1;e>=0;e--){var n=this.entries[e];if(n.type===FormattingElementList.MARKER_ENTRY)return null;if(this.treeAdapter.getTagName(n.element)===t)return n}return null},FormattingElementList.prototype.getElementEntry=function(t){for(var e=this.length-1;e>=0;e--){var n=this.entries[e];if(n.type===FormattingElementList.ELEMENT_ENTRY&&n.element==t)return n}return null};