montageDefine("c9483d2","dom/level2/style",{dependencies:["./core","./html","../utils","cssom","cssstyle","assert"],factory:function(e,t,s){function i(e,t){h.resourceLoader.load(this,e,function(s,i){t.href=h.resourceLoader.resolve(this.ownerDocument,e),l.call(this,s,t,e)})}function l(e,t,s){var i=y.parse(e),l=i.cssRules;l.unshift(0,t.cssRules.length),Array.prototype.splice.apply(t.cssRules,l),n.call(this,t.cssRules,s),this.ownerDocument.styleSheets.push(t)}function n(e,t){if(e)for(var s=0;s<e.length;++s)e[s].cssRules?n.call(this,e[s].cssRules,t):e[s].href&&i.call(this,e[s].href,this.sheet)}function o(e,t){this._node=e,r.Attr.call(this,e.ownerDocument,"style"),this._node._ignoreValueOfStyleAttr||(this.nodeValue=t)}var r=e("./core").dom.level2.core,h=e("./html").dom.level2.html,c=e("../utils"),y=e("cssom"),u=e("cssstyle"),S=e("assert");r.StyleSheet=y.StyleSheet,r.MediaList=y.MediaList,r.CSSStyleSheet=y.CSSStyleSheet,r.CSSRule=y.CSSRule,r.CSSStyleRule=y.CSSStyleRule,r.CSSMediaRule=y.CSSMediaRule,r.CSSImportRule=y.CSSImportRule,r.CSSStyleDeclaration=u.CSSStyleDeclaration,r.StyleSheetList=function(){this._length=0},r.StyleSheetList.prototype={item:function(e){return this[e]},push:function(e){this[this._length]=e,this._length++},get length(){return this._length}},r.Document.prototype.__defineGetter__("styleSheets",function(){return this._styleSheets||(this._styleSheets=new r.StyleSheetList),this._styleSheets}),o.prototype={get nodeValue(){return"string"==typeof this._node._style?this._node._style:this._node.style.cssText},set nodeValue(e){this._node._style=e}},o.prototype.__proto__=r.Attr.prototype,c.intercept(r.AttrNodeMap,"setNamedItem",function(e,t,s){return"style"==s.name&&(s=new o(this._parentNode,s.nodeValue)),e.call(this,s)}),h.HTMLElement.prototype.__defineGetter__("style",function(){if("string"==typeof this._style){var e=y.parse("dummy{"+this._style+"}");if(this._style=new u.CSSStyleDeclaration,e.cssRules.length>0&&e.cssRules[0].style)for(var t=e.cssRules[0].style,s=0;s<t.length;++s){var i=t[s];this._style.setProperty(i,t.getPropertyValue(i),t.getPropertyPriority(i))}}return this._style||(this._style=new u.CSSStyleDeclaration),this.getAttributeNode("style")||(this._ignoreValueOfStyleAttr=!0,this.setAttribute("style"),this._ignoreValueOfStyleAttr=!1),this._style}),S.equal(void 0,h.HTMLLinkElement._init),h.HTMLLinkElement._init=function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){/(?:[ \t\n\r\f]|^)stylesheet(?:[ \t\n\r\f]|$)/i.test(this.rel)&&this.href&&i.call(this,this.href,this.sheet)}),this.addEventListener("DOMNodeRemovedFromDocument",function(){})};var a=function(){return this._cssStyleSheet||(this._cssStyleSheet=new y.CSSStyleSheet),this._cssStyleSheet};h.HTMLLinkElement.prototype.__defineGetter__("sheet",a),S.equal(void 0,h.HTMLStyleElement._init),h.HTMLStyleElement._init=function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!this.type||"text/css"===this.type){var e="";Array.prototype.forEach.call(this.childNodes,function(t){t.nodeType===t.TEXT_NODE&&(e+=t.nodeValue)}),l.call(this,e,this.sheet,this._ownerDocument.URL)}})},h.HTMLStyleElement.prototype.__defineGetter__("sheet",a),t.dom={level2:{html:h,core:r}}}});